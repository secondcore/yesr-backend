Ext.define("Ext.layout.ContextItem",{requires:["Ext.layout.ClassList"],heightModel:null,widthModel:null,sizeModel:null,boxChildren:null,boxParent:null,children:[],dirty:null,dirtyCount:0,hasRawContent:true,isContextItem:true,isTopLevel:false,consumersContentHeight:0,consumersContentWidth:0,consumersContainerHeight:0,consumersContainerWidth:0,consumersHeight:0,consumersWidth:0,ownerCtContext:null,remainingChildLayouts:0,remainingComponentChildLayouts:0,remainingContainerChildLayouts:0,wrapsComponent:false,constructor:function(a){var d=this,e=a.target,c,b;Ext.apply(d,a);c=d.el;d.id=c.id;d.lastBox=c.lastBox;d.blocks={};d.domBlocks={};d.triggers={};d.domTriggers={};d.flushedProps={};d.props={};d.state={};d.styles={};if(e.isComponent){d.wrapsComponent=true;d.sizeModel=b=e.getSizeModel(d.ownerCtContext&&d.ownerCtContext.sizeModel);d.widthModel=b.width;d.heightModel=b.height;d.frameBodyContext=d.getEl("frameBody")}},init:function(c){var d=this,b,a;if(c){d.ownerCtContext=c;d.isBoxParent=d.target.ownerLayout.isItemBoxParent(d);a=d.widthModel;if(a.shrinkWrap){b=c.isBoxParent?c:c.boxParent;if(b){b.addBoxChild(d)}}else{if(a.natural){d.boxParent=c}}}else{d.isTopLevel=true}},initAnimatePolicy:function(){var b=this,c=b.target,a=b.ownerCtContext;if(a&&a.isTopLevel){b.animatePolicy=c.ownerLayout.getAnimatePolicy(b)}else{if(!a&&c.isCollapsingOrExpanding&&c.animCollapse){b.animatePolicy=c.componentLayout.getAnimatePolicy(b)}}if(b.animatePolicy){b.context.queueAnimation(b)}},noFraming:{left:0,top:0,right:0,bottom:0,width:0,height:0},addCls:function(a){this.getClassList().addMany(a)},removeCls:function(a){this.getClassList().removeMany(a)},addBlock:function(b,d,e){var c=this,f=c[b],a=f[e]||(f[e]={});if(!a[d.id]){a[d.id]=d;++d.blockCount;++c.context.blockCount}},addBoxChild:function(d){var c=this,b,a=d.widthModel;d.boxParent=this;d.measuresBox=a.shrinkWrap?d.hasRawContent:a.natural;if(d.measuresBox){b=c.boxChildren;if(b){b.push(d)}else{c.boxChildren=[d]}}},addTrigger:function(e,f){var d=this,g=f?d.domTriggers:d.triggers,a=d.context,c=a.currentLayout,b=g[e]||(g[e]={});if(!b[c.id]){b[c.id]=c;++c.triggerCount;b=a.triggers[f?"dom":"data"];(b[c.id]||(b[c.id]=[])).push({item:this,prop:e});if(d.props[e]!==undefined){if(!f||!(d.dirty&&(e in d.dirty))){++c.firedTriggers}}}},boxChildMeasured:function(){var b=this,c=b.state,a=(c.boxesMeasured=(c.boxesMeasured||0)+1);if(a==b.boxChildren.length){c.clearBoxWidth=1;++b.context.progressCount;b.markDirty()}},borderNames:["border-top-width","border-right-width","border-bottom-width","border-left-width"],marginNames:["margin-top","margin-right","margin-bottom","margin-left"],paddingNames:["padding-top","padding-right","padding-bottom","padding-left"],trblNames:["top","right","bottom","left"],cacheMissHandlers:{borderInfo:function(a){var b=a.getStyles(a.borderNames,a.trblNames);b.width=b.left+b.right;b.height=b.top+b.bottom;return b},marginInfo:function(a){var b=a.getStyles(a.marginNames,a.trblNames);b.width=b.left+b.right;b.height=b.top+b.bottom;return b},paddingInfo:function(b){var a=b.frameBodyContext||b,c=a.getStyles(b.paddingNames,b.trblNames);c.width=c.left+c.right;c.height=c.top+c.bottom;return c}},checkCache:function(a){return this.cacheMissHandlers[a](this)},clearAllBlocks:function(a){var c=this[a],b;if(c){for(b in c){this.clearBlocks(a,b)}}},clearBlocks:function(c,f){var g=this[c],b=g&&g[f],d,e,a;if(b){delete g[f];d=this.context;for(a in b){e=b[a];--d.blockCount;if(!--e.blockCount&&!e.pending&&!e.done){d.queueLayout(e)}}}},block:function(a,b){this.addBlock("blocks",a,b)},domBlock:function(a,b){this.addBlock("domBlocks",a,b)},doInvalidate:function(c){var d=this,b=d.props,a=d.dirty,e=d.target.ownerLayout;d.dirty=d.invalid=false;d.props={};d.state={};d.clearAllBlocks("blocks");d.clearAllBlocks("domBlocks");if(d.wrapsComponent){if(!c){d.recoverProp("x",b,a);d.recoverProp("y",b,a);if(d.widthModel.calculated){d.recoverProp("width",b,a)}if(d.heightModel.calculated){d.recoverProp("height",b,a)}}else{d.widthModel=d.sizeModel.width;d.heightModel=d.sizeModel.height}}if(e&&e.manageMargins){d.recoverProp("margin-top",b,a);d.recoverProp("margin-right",b,a);d.recoverProp("margin-bottom",b,a);d.recoverProp("margin-left",b,a)}},fireTriggers:function(b,f){var d=this[b][f],c=this.context,e,a;if(d){for(a in d){e=d[a];++e.firedTriggers;if(!e.done&&!e.blockCount&&!e.pending){c.queueLayout(e)}}}},flush:function(){var b=this,a=b.dirty,c=b.state,d=b.el;b.dirtyCount=0;if(b.classList&&b.classList.dirty){b.classList.flush()}if("attributes" in b){d.set(b.attributes);delete b.attributes}if("innerHTML" in b){d.innerHTML=b.innerHTML;delete b.innerHTML}if(c.clearBoxWidth){c.clearBoxWidth=0;b.el.setStyle("width",null);if(!--c.blocks){b.context.queueItemLayouts(b)}}if(a){delete b.dirty;b.writeProps(a,true)}},flushAnimations:function(){var n=this,c=n.lastBox,k,m,e,g,f,d,h,l,i,a,b;if(c){k=n.target;m=k.layout&&k.layout.animate;if(m){e=Ext.isNumber(m)?m:m.duration}g=Ext.Object.getKeys(n.animatePolicy);f=Ext.apply({},{from:{},to:{},duration:e||Ext.fx.Anim.prototype.duration},m);for(d=0,h=0,l=g.length;h<l;h++){i=g[h];a=c[i];b=n.peek(i);if(a!=b){i=n.translateProps[i]||i;f.from[i]=a;f.to[i]=b;++d}}if(d){if(n.isCollapsingOrExpanding===1){k.componentLayout.undoLayout(n)}else{n.writeProps(f.from)}n.el.animate(f);Ext.fx.Manager.getFxQueue(n.el.id)[0].on({afteranimate:function(){if(n.isCollapsingOrExpanding===1){k.componentLayout.redoLayout(n);k.afterCollapse(true)}else{if(n.isCollapsingOrExpanding===2){k.afterExpand(true)}}}})}}},getBorderInfo:function(){var a=this,b=a.borderInfo;if(!b){a.borderInfo=b=a.checkCache("borderInfo")}return b},getClassList:function(){return this.classList||(this.classList=new Ext.layout.ClassList(this))},getEl:function(c,a){var e=this,f,d,b;if(c){if(c.dom){d=c}else{f=e.target;if(a){f=a}d=f[c];if(typeof d=="function"){d=d.call(f);if(d===e.el){return this}}}if(d){b=e.context.getEl(e,d)}}return b||null},getFraming:function(){var a=this;if(!a.framingInfo){a.framingInfo=a.target.frameSize||a.noFraming}return a.framingInfo},getFrameInfo:function(){var b=this,c=b.frameInfo,d,a;if(!c){d=b.getFraming();a=b.getBorderInfo();b.frameInfo=c={top:d.top+a.top,right:d.right+a.right,bottom:d.bottom+a.bottom,left:d.left+a.left,width:d.width+a.width,height:d.height+a.height}}return c},getMarginInfo:function(){var d=this,g=d.marginInfo,b,a,f,e,c;if(!g){if(!d.wrapsComponent){g=d.checkCache("marginInfo")}else{b=d.target;e=b.ownerLayout;c=e?e.id:null;a=e&&e.manageMargins;g=b.margin$;if(g&&g.ownerId!==c){g=null}if(!g){g=d.parseMargins(b.margin)||d.checkCache("marginInfo");if(a){f=d.parseMargins(b.margins,e.defaultMargins);if(f){g={top:g.top+f.top,right:g.right+f.right,bottom:g.bottom+f.bottom,left:g.left+f.left}}d.setProp("margin-top",0);d.setProp("margin-right",0);d.setProp("margin-bottom",0);d.setProp("margin-left",0)}g.ownerId=c;b.margin$=g}g.width=g.left+g.right;g.height=g.top+g.bottom}d.marginInfo=g}return g},clearMarginCache:function(){delete this.marginInfo;delete this.target.margin$},getPaddingInfo:function(){var a=this,b=a.paddingInfo;if(!b){a.paddingInfo=b=a.checkCache("paddingInfo")}return b},getProp:function(c){var b=this,a=b.props[c];b.addTrigger(c);return a},getDomProp:function(c){var b=this,a=(b.dirty&&(c in b.dirty))?undefined:b.props[c];b.addTrigger(c,true);return a},getStyle:function(a){var c=this,b=c.styles,e,d;if(a in b){d=b[a]}else{e=c.styleInfo[a];d=c.el.getStyle(a);if(e&&e.parseInt){d=parseInt(d,10)||0}b[a]=d}return d},getStyles:function(o,b){var l=this,e=l.styles,p={},f=0,d=o.length,j,h,k,a,c,g,q,m;b=b||o;for(j=0;j<d;++j){a=o[j];if(a in e){p[b[j]]=e[a];++f;if(j&&f==1){h=o.slice(0,j);k=b.slice(0,j)}}else{if(f){(h||(h=[])).push(a);(k||(k=[])).push(b[j])}}}if(f<d){h=h||o;k=k||b;g=l.styleInfo;q=l.el.getStyle(h);for(j=h.length;j--;){a=h[j];c=g[a];m=q[a];if(c&&c.parseInt){m=parseInt(m,10)||0}p[k[j]]=m;e[a]=m}}return p},hasProp:function(b){var a=this.getProp(b);return typeof a!="undefined"},hasDomProp:function(b){var a=this.getDomProp(b);return typeof a!="undefined"},invalidate:function(a){this.invalid=true;this.context.queueInvalidate(this,a)},markDirty:function(){if(++this.dirtyCount==1){this.context.queueFlush(this)}},onBoxMeasured:function(){var a=this.boxParent,b=this.state;if(a&&a.widthModel.shrinkWrap&&!b.boxMeasured&&this.measuresBox){b.boxMeasured=1;a.boxChildMeasured()}},parseMargins:function(d,c){if(d===true){d=5}var b=typeof d,a;if(b=="string"||b=="number"){a=Ext.util.Format.parseBox(d)}else{if(d||c){a={top:0,right:0,bottom:0,left:0};if(c){Ext.apply(a,this.parseMargins(c))}Ext.apply(a,d)}}return a},peek:function(a){return this.props[a]},recoverProp:function(f,b,a){var e=this,d=e.props,c;if(f in b){d[f]=b[f];if(a&&f in a){c=e.dirty||(e.dirty={});c[f]=a[f]}}},redo:function(b){var e=this,c,a,d;e.revertProps(e.props);if(b&&e.wrapsComponent){if(e.childItems){for(d=0,c=e.childItems,a=c.length;d<a;d++){c[d].redo(b)}}for(d=0,c=e.children,a=c.length;d<a;d++){c[d].redo()}}},revertProps:function(d){var a,b=this.flushedProps,c={};for(a in d){if(b.hasOwnProperty(a)){c[a]=d[a]}}this.writeProps(c)},setAttribute:function(a,c){var b=this;if(!b.attributes){b.attributes={}}b.attributes[a]=c;b.markDirty()},setBox:function(b){var a=this;if("left" in b){a.setProp("x",b.left)}if("top" in b){a.setProp("y",b.top)}a.setSize(b.width,b.height)},setContentHeight:function(a,b){if(!b&&this.hasRawContent){return 1}return this.setProp("contentHeight",a)},setContentWidth:function(b,a){if(!a&&this.hasRawContent){return 1}return this.setProp("contentWidth",b)},setContentSize:function(c,a,b){return this.setContentWidth(c,b)+this.setContentHeight(a,b)==2},setProp:function(d,c,a){var b=this,g=typeof c,f,e;if(g=="undefined"||(g==="number"&&isNaN(c))){return 0}if(b.props[d]===c){return 1}b.props[d]=c;++b.context.progressCount;if(a===false){b.fireTriggers("domTriggers",d);b.clearBlocks("domBlocks",d)}else{e=b.styleInfo[d];if(e){if(!b.dirty){b.dirty={}}if(d=="width"||d=="height"){f=b.isBorderBoxValue;if(f==null){b.isBorderBoxValue=f=!!b.el.isBorderBox()}if(!f){b.borderInfo||b.getBorderInfo();b.paddingInfo||b.getPaddingInfo()}}b.dirty[d]=c;b.markDirty()}}b.fireTriggers("triggers",d);b.clearBlocks("blocks",d);return 1},setHeight:function(a,c){var e=this,b=e.target,g,d,f;if(a<0){a=0}if(!e.wrapsComponent){if(!e.setProp("height",a,c)){return NaN}}else{a=Ext.Number.constrain(a,b.minHeight||0,b.maxHeight);if(!e.setProp("height",a,c)){return NaN}g=e.frameBodyContext;if(g){d=e.getFrameInfo();g.setHeight(a-d.height,c)}}return a},setWidth:function(c,b){var e=this,a=e.target,g,d,f;if(c<0){c=0}if(!e.wrapsComponent){if(!e.setProp("width",c,b)){return NaN}}else{c=Ext.Number.constrain(c,a.minWidth||0,a.maxWidth);if(!e.setProp("width",c,b)){return NaN}g=e.frameBodyContext;if(g){d=e.getFrameInfo();g.setWidth(c-d.width,b)}}return c},setSize:function(c,a,b){this.setWidth(c,b);this.setHeight(a,b)},translateProps:{x:"left",y:"top"},undo:function(b){var e=this,c,a,d;e.revertProps(e.lastBox);if(b&&e.wrapsComponent){if(e.childItems){for(d=0,c=e.childItems,a=c.length;d<a;d++){c[d].undo(b)}}for(d=0,c=e.children,a=c.length;d<a;d++){c[d].undo()}}},unsetProp:function(b){var a=this.dirty;delete this.props[b];if(a){delete a[b]}},writeProps:function(d,c){if(!(d&&typeof d=="object")){Ext.Logger.warn("writeProps expected dirtyProps to be an object");return}var t=this,b=t.el,f={},e=0,a=t.styleInfo,s,k,n,j="x" in d,i="y" in d,h=d.x,g=d.y,o=d.width,m=d.height,r=t.isBorderBoxValue,u=t.target,p=Math.max,q=0,l=0;if("displayed" in d){b.setDisplayed(d.displayed)}for(k in d){if(c){t.fireTriggers("domTriggers",k);t.clearBlocks("domBlocks",k);t.flushedProps[k]=1}s=a[k];if(s&&s.dom){if(s.suffix&&(n=parseInt(d[k],10))){f[k]=n+s.suffix}else{f[k]=d[k]}++e}}if(j||i){if(u.isComponent){u.setPosition(h||t.props.x,g||t.props.y)}else{if(j){f.left=h+"px";++e}if(i){f.top=g+"px";++e}}}if(!r&&(o>0||m>0)){if(!(t.borderInfo&&t.paddingInfo)){throw Error("Needed to have gotten the borderInfo and paddingInfo when the width or height was setProp'd")}if(!t.frameBodyContext){q=t.paddingInfo.width;l=t.paddingInfo.height}if(o){o=p(parseInt(o,10)-(t.borderInfo.width+q),0);f.width=o+"px";++e}if(m){m=p(parseInt(m,10)-(t.borderInfo.height+l),0);f.height=m+"px";++e}}if(e){b.setStyle(f)}}},function(){var c={dom:true,parseInt:true,suffix:"px"},b={dom:true},a={dom:false};this.prototype.styleInfo={childrenDone:a,componentChildrenDone:a,containerChildrenDone:a,containerLayoutDone:a,displayed:a,done:a,x:a,y:a,left:c,top:c,right:c,bottom:c,width:c,height:c,"border-top-width":c,"border-right-width":c,"border-bottom-width":c,"border-left-width":c,"margin-top":c,"margin-right":c,"margin-bottom":c,"margin-left":c,"padding-top":c,"padding-right":c,"padding-bottom":c,"padding-left":c,"line-height":b,display:b}});