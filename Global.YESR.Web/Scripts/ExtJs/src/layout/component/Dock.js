Ext.define("Ext.layout.component.Dock",{extend:"Ext.layout.component.Component",alias:"layout.dock",alternateClassName:"Ext.layout.component.AbstractDock",type:"dock",initializedBorders:-1,horizontalCollapsePolicy:{width:true,x:true},verticalCollapsePolicy:{height:true,y:true},finishRender:function(){var b=this,c,a;b.callParent();c=b.getRenderTarget();a=b.getDockedItems();b.finishRenderItems(c,a)},isItemBoxParent:function(a){return true},isItemShrinkWrap:function(a){return true},dockOpposites:{top:"bottom",right:"left",bottom:"top",left:"right"},handleItemBorders:function(){var k=this,a=k.owner,j,n,d=k.borders,f=k.dockOpposites,b=a.dockedItems.generation,e,h,m,l,g,c=k.collapsed;if(k.initializedBorders==b||(a.border&&!a.manageBodyBorders)){return}k.initializedBorders=b;k.collapsed=false;n=k.getLayoutItems();k.collapsed=c;j={top:[],right:[],bottom:[],left:[]};for(e=0,h=n.length;e<h;e++){m=n[e];l=m.dock;if(m.ignoreBorderManagement){continue}if(!j[l].satisfied){j[l].push(m);j[l].satisfied=true}if(!j.top.satisfied&&f[l]!=="top"){j.top.push(m)}if(!j.right.satisfied&&f[l]!=="right"){j.right.push(m)}if(!j.bottom.satisfied&&f[l]!=="bottom"){j.bottom.push(m)}if(!j.left.satisfied&&f[l]!=="left"){j.left.push(m)}}if(d){for(g in d){if(d.hasOwnProperty(g)){h=d[g].length;if(!a.manageBodyBorders){for(e=0;e<h;e++){d[g][e].removeCls(Ext.baseCSSPrefix+"docked-noborder-"+g)}if(!d[g].satisfied&&!a.bodyBorder){a.removeBodyCls(Ext.baseCSSPrefix+"docked-noborder-"+g)}}else{if(d[g].satisfied){a.setBodyStyle("border-"+g+"-width","")}}}}}for(g in j){if(j.hasOwnProperty(g)){h=j[g].length;if(!a.manageBodyBorders){for(e=0;e<h;e++){j[g][e].addCls(Ext.baseCSSPrefix+"docked-noborder-"+g)}if((!j[g].satisfied&&!a.bodyBorder)||a.bodyBorder===false){a.addBodyCls(Ext.baseCSSPrefix+"docked-noborder-"+g)}}else{if(j[g].satisfied){a.setBodyStyle("border-"+g+"-width","1px")}}}}k.borders=j},beginLayout:function(d){var l=this,c=l.owner,o=l.getLayoutItems(),b=d.context,g=o.length,k=false,e=false,m,j,n,a,f,h;l.callParent(arguments);l.handleItemBorders();h=c.getCollapsed();if(Ext.isDefined(l.lastCollapsedState)&&(h!==l.lastCollapsedState)){if(l.owner.collapsed){d.isCollapsingOrExpanding=1;c.addClsWithUI(c.collapsedCls)}else{d.isCollapsingOrExpanding=2;c.removeClsWithUI(c.collapsedCls);d.lastCollapsedState=l.lastCollapsedState}}l.lastCollapsedState=h;d.dockedItems=m=[];for(j=0;j<g;j++){n=o[j];a=b.getCmp(n);a.dockedAt={x:0,y:0};a.offsets=f=Ext.Element.parseBox(n.offsets||{});f.width=f.left+f.right;f.height=f.top+f.bottom;m.push(a)}if(c.collapsed){if(c.collapsedVertical()){k=true;d.measureDimensions=1}else{e=true;d.measureDimensions=2}}d.collapsedVert=k;d.collapsedHorz=e;d.bodyContext=d.getEl("body")},beginLayoutCycle:function(b){var e=this,k=b.dockedItems,d=k.length,a=e.owner,f=a.frameBody,j=e.lastHeightModel,c,h,g;e.callParent(arguments);if(b.collapsedVert){b.heightModel=e.sizeModels.shrinkWrap}else{if(b.collapsedHorz){b.widthModel=e.sizeModels.shrinkWrap}}if(j&&j.shrinkWrap&&!b.heightModel.shrinkWrap&&!e.owner.manageHeight){a.body.dom.style.marginBottom=""}if(b.widthModel.auto){if(b.widthModel.shrinkWrap){a.el.setWidth(null)}a.body.setWidth(null);if(f){f.setWidth(null)}}if(b.heightModel.auto){a.body.setHeight(null);if(f){f.setHeight(null)}}if(b.collapsedVert){b.setContentHeight(0)}else{if(b.collapsedHorz){b.setContentWidth(0)}}for(c=0;c<d;c++){h=k[c].target;g=h.dock;if(g=="right"){h.el.setLeft(0)}else{if(g!="left"){continue}}}},calculate:function(d){var j=this,c=j.measureAutoDimensions(d,d.measureDimensions),b=d.state,i=b.horzDone,e=b.vertDone,f=d.bodyContext,a,h,g,k;d.borderInfo||d.getBorderInfo();d.paddingInfo||d.getPaddingInfo();d.framingInfo||d.getFraming();f.borderInfo||f.getBorderInfo();f.paddingInfo||f.getPaddingInfo();a=!i&&j.createAxis(d,c.contentWidth,d.widthModel,"left","right","x","width","Width",d.collapsedHorz);h=!e&&j.createAxis(d,c.contentHeight,d.heightModel,"top","bottom","y","height","Height",d.collapsedVert);for(g=0,k=d.dockedItems.length;k--;++g){if(a){j.dockChild(d,a,k,g)}if(h){j.dockChild(d,h,k,g)}}if(a&&j.finishAxis(d,a)){b.horzDone=i=a}if(h&&j.finishAxis(d,h)){b.vertDone=e=h}if(i&&e&&j.finishConstraints(d,i,e)){j.finishPositions(d,i,e)}else{j.done=false}},createAxis:function(o,i,e,m,h,s,l,j,d){var u=0,b=this.owner,f=b["max"+j],c=b["min"+j]||0,k=f!=null,v=o.state["constrained"+j],n=v!=null,t="set"+j,q,a,r,p,g;if(e.shrinkWrap&&!n){if(d){g=0}else{a=o.bodyContext;g=i+a.borderInfo[l]}}else{q=o.borderInfo;r=o.framingInfo;p=o.paddingInfo;if(n){g=v;e=this.sizeModels.calculated;o[t](v)}else{g=o.getProp(l)}g-=q[h]+p[h]+r[h];u=q[m]+p[m]+r[m]}return{shrinkWrap:e.shrinkWrap,sizeModel:e,begin:u,end:g,collapsed:d,horizontal:s=="x",ignoreFrameBegin:false,ignoreFrameEnd:false,initialSize:g-u,hasMinMaxConstraints:(c||k)&&e.shrinkWrap,isConstrainedSize:n,minSize:c,maxSize:k?f:1000000000,bodyPosProp:this.owner.manageHeight?s:("margin-"+m),dockBegin:m,dockEnd:h,posProp:s,sizeProp:l,sizePropCap:j,setSize:t,dockedPixelsEnd:0}},dockChild:function(b,c,i,d){var e=this,a=b.dockedItems[c.shrinkWrap?i:d],g=a.target,h=g.dock,f;if(g.ignoreParentFrame&&b.isCollapsingOrExpanding){a.clearMarginCache()}if(h==c.dockBegin){if(c.shrinkWrap){f=e.dockOutwardBegin(b,a,g,c)}else{f=e.dockInwardBegin(b,a,g,c)}}else{if(h==c.dockEnd){if(c.shrinkWrap){f=e.dockOutwardEnd(b,a,g,c)}else{f=e.dockInwardEnd(b,a,g,c)}}else{f=e.dockStretch(b,a,g,c)}}a.dockedAt[c.posProp]=f},dockInwardBegin:function(f,e,d,b){var h=b.begin,g=b.sizeProp,a,c;if(d.ignoreParentFrame){c=d.dock;h-=f.borderInfo[c]+f.paddingInfo[c]+f.framingInfo[c]}if(!d.overlay){a=e.getProp(g)+e.getMarginInfo()[g];b.begin+=a}return h},dockInwardEnd:function(e,d,c,b){var g=b.sizeProp,a=d.getProp(g)+d.getMarginInfo()[g],f=b.end-a;if(!c.overlay){b.end=f}if(c.ignoreParentFrame){f+=e.borderInfo[c.dock]+e.paddingInfo[c.dock]+e.framingInfo[c.dock]}return f},dockOutwardBegin:function(f,e,d,b){var h=b.begin,g=b.sizeProp,c,a;if(b.collapsed){b.ignoreFrameBegin=b.ignoreFrameEnd=true}else{if(d.ignoreParentFrame){c=d.dock;h-=f.borderInfo[c]+f.paddingInfo[c]+f.framingInfo[c];b.ignoreFrameBegin=true}}if(!d.overlay){a=e.getProp(g)+e.getMarginInfo()[g];h-=a;b.begin=h}return h},dockOutwardEnd:function(f,e,d,b){var h=b.end,g=b.sizeProp,c,a;a=e.getProp(g)+e.getMarginInfo()[g];if(b.collapsed){b.ignoreFrameBegin=b.ignoreFrameEnd=true}else{if(d.ignoreParentFrame){c=d.dock;h+=f.borderInfo[c]+f.paddingInfo[c]+f.framingInfo[c];b.ignoreFrameEnd=true}}if(!d.overlay){b.end=h+a;b.dockedPixelsEnd+=a}return h},dockStretch:function(c,b,m,d){var n=m.dock,i=d.sizeProp,a=n=="top"||n=="bottom",e=b.offsets,h=c.borderInfo,l=c.paddingInfo,g=a?"right":"bottom",p=a?"left":"top",k=d.begin+e[p],f,o,j;if(m.stretch!==false){o=d.end-k-e[g];if(m.ignoreParentFrame){j=c.framingInfo;k-=h[p]+l[p]+j[p];o+=h[i]+l[i]+j[i]}f=b.getMarginInfo();o-=f[i];b[d.setSize](o)}return k},finishAxis:function(c,e){var n=e.end-e.begin,k=e.setSize,d=e.dockBegin,h=e.dockEnd,i=c.borderInfo,l=c.paddingInfo,j=c.framingInfo,g=l[d]+i[d]+j[d],f=c.bodyContext,m,a,b;if(e.shrinkWrap){e.delta=-e.begin;a=e.initialSize;if(e.ignoreFrameBegin){e.delta-=i[d];m=-e.begin-g}else{n+=g;e.delta+=l[d]+j[d];m=-e.begin}if(!e.ignoreFrameEnd){n+=l[h]+i[h]+j[h]}e.size=n;if(!e.horizontal&&!this.owner.manageHeight){b=false}}else{e.delta=-i[e.dockBegin];a=n;m=e.begin-g}f[k](a,b);f.setProp(e.bodyPosProp,m);return !isNaN(n)},finishConstraints:function(f,a,h){var k=a.size<a.minSize,b=a.size>a.maxSize,i=h.size<h.minSize,c=h.size>h.maxSize,e=f.state,j=true,g=this.sizeModels.configured,d;if(a.shrinkWrap&&b&&h.shrinkWrap&&i){e.constrainedWidth=a.maxSize;f.widthModel=g;j=false}else{if(a.shrinkWrap){if(b){e.constrainedWidth=a.maxSize;f.widthModel=g;j=false}else{if(k){e.constrainedWidth=a.minSize;f.widthModel=g;j=false}}}if(h.shrinkWrap){if(c){e.constrainedHeight=h.maxSize;f.heightModel=g;j=false}else{if(i){e.constrainedHeight=h.minSize;f.heightModel=g;j=false}}}}if(j){if(a.shrinkWrap){f.setWidth(a.size)}if(h.shrinkWrap){if(!f.collapsedVert&&!this.owner.manageHeight){d=false;f.bodyContext.setProp("margin-bottom",h.dockedPixelsEnd)}f.setHeight(h.size,d)}}else{f.invalidate({state:{constrainedWidth:e.constrainedWidth,constrainedHeight:e.constrainedHeight}})}return j},finishPositions:function(d,a,g){var i=d.dockedItems,c=i.length,f=a.delta,e=g.delta,h,b;for(h=0;h<c;++h){b=i[h];b.setProp("x",f+b.dockedAt.x);b.setProp("y",e+b.dockedAt.y)}},finishedLayout:function(b){var a=this,c=b.target;a.callParent(arguments);if(!b.animatePolicy){if(b.isCollapsingOrExpanding===1){c.afterCollapse(false)}else{if(b.isCollapsingOrExpanding===2){c.afterExpand(false)}}}},getAnimatePolicy:function(c){var b=this,a,d;if(c.isCollapsingOrExpanding==1){a=b.lastCollapsedState}else{if(c.isCollapsingOrExpanding==2){a=c.lastCollapsedState}}if(a=="left"||a=="right"){d=b.horizontalCollapsePolicy}else{if(a=="top"||a=="bottom"){d=b.verticalCollapsePolicy}}return d},getDockedItems:function(c,l){var g=this,h=g.owner.dockedItems.items,f=h&&h.length&&c!==false,b,k,j,e,d,a;if(l==null){j=f?h.slice():h}else{j=[];for(e=0,a=h.length;e<a;++e){k=h[e].dock;d=(k=="top"||k=="left");if(l?d:!d){j.push(h[e])}}f=f&&j.length}if(f){b=(c=c||"render")=="render";Ext.Array.sort(j,function(m,i){var n,o;if(b&&((n=g.owner.dockOrder[m.dock])!==(o=g.owner.dockOrder[i.dock]))){if(!(n+o)){return n-o}}n=g.getItemWeight(m,c);o=g.getItemWeight(i,c);if((n!==undefined)&&(o!==undefined)){return n-o}return 0})}return j||[]},getItemWeight:function(b,a){var c=b.weight||this.owner.defaultDockWeights[b.dock];return c[a]||c},getLayoutItems:function(){var e=this,b,f,d,c,a;if(e.owner.collapsed){a=e.owner.getCollapsedDockedItems()}else{b=e.getDockedItems("visual");f=b.length;a=[];for(c=0;c<f;c++){d=b[c];if(!d.hidden){a.push(d)}}}return a},measureContentWidth:function(a){var b=a.bodyContext;return b.el.getWidth()-b.getBorderInfo().width},measureContentHeight:function(a){var b=a.bodyContext;return b.el.getHeight()-b.getBorderInfo().height},redoLayout:function(c){var b=this,a=b.owner;if(c.isCollapsingOrExpanding==1){if(a.reExpander){a.reExpander.el.show()}a.addClsWithUI(a.collapsedCls);c.redo(true)}else{if(c.isCollapsingOrExpanding==2){a.removeClsWithUI(a.collapsedCls);c.bodyContext.redo()}}},renderChildren:function(){var b=this,a=b.getDockedItems(),c=b.getRenderTarget();b.renderItems(a,c)},renderItems:function(h,g){var l=this,c=h.length,a=0,b=0,n,o=0,k=l.getRenderTarget().dom.childNodes,m=k.length,f,d,e,n;for(f=0,d=0;f<m;f++){e=k[f];if(Ext.fly(e).hasCls("x-resizable-handle")){break}for(d=0;d<c;d++){n=h[d];if(n.rendered&&n.el.dom===e){break}}if(d===c){o++}}for(;a<c;a++,b++){n=h[a];if(a===b&&(n.dock==="right"||n.dock==="bottom")){b+=o}if(n&&!n.rendered){l.renderItem(n,g,b)}else{if(!l.isValidParent(n,g,b)){l.moveItem(n,g,b)}}}},undoLayout:function(c){var b=this,a=b.owner;if(c.isCollapsingOrExpanding==1){if(a.reExpander){a.reExpander.el.hide()}a.removeClsWithUI(a.collapsedCls);c.undo(true)}else{if(c.isCollapsingOrExpanding==2){a.addClsWithUI(a.collapsedCls);c.bodyContext.undo()}}},sizePolicy:{nostretch:{setsWidth:0,setsHeight:0},stretchH:{setsWidth:1,setsHeight:0},stretchV:{setsWidth:0,setsHeight:1},autoStretchH:{readsWidth:1,setsWidth:1,setsHeight:0},autoStretchV:{readsHeight:1,setsWidth:0,setsHeight:1}},getItemSizePolicy:function(c){var d=this.sizePolicy,b,a;if(c.stretch===false){return d.nostretch}b=c.dock;a=(b=="left"||b=="right");if(a){return d.stretchV}return d.stretchH},configureItem:function(a,b){this.callParent(arguments);a.addCls(Ext.baseCSSPrefix+"docked");a.addClsWithUI("docked-"+a.dock)},afterRemove:function(a){this.callParent(arguments);if(this.itemCls){a.el.removeCls(this.itemCls+"-"+a.dock)}var b=a.el.dom;if(!a.destroying&&b){b.parentNode.removeChild(b)}this.childrenChanged=true}});