Ext.define("Ext.chart.series.Bar",{extend:"Ext.chart.series.Cartesian",alternateClassName:["Ext.chart.BarSeries","Ext.chart.BarChart","Ext.chart.StackedBarChart"],requires:["Ext.chart.axis.Axis","Ext.fx.Anim"],type:"bar",alias:"series.bar",column:false,style:{},gutter:38.2,groupGutter:38.2,xPadding:0,yPadding:10,constructor:function(c){this.callParent(arguments);var e=this,a=e.chart.surface,f=e.chart.shadow,d,b;c.highlightCfg=Ext.Object.merge({lineWidth:3,stroke:"#55c",opacity:0.8,color:"#f00"},c.highlightCfg);Ext.apply(e,c,{shadowAttributes:[{"stroke-width":6,"stroke-opacity":0.05,stroke:"rgb(200, 200, 200)",translate:{x:1.2,y:1.2}},{"stroke-width":4,"stroke-opacity":0.1,stroke:"rgb(150, 150, 150)",translate:{x:0.9,y:0.9}},{"stroke-width":2,"stroke-opacity":0.15,stroke:"rgb(100, 100, 100)",translate:{x:0.6,y:0.6}}]});e.group=a.getGroup(e.seriesId+"-bars");if(f){for(d=0,b=e.shadowAttributes.length;d<b;d++){e.shadowGroups.push(a.getGroup(e.seriesId+"-shadows"+d))}}},getBarGirth:function(){var d=this,a=d.chart.getChartStore(),b=d.column,c=a.getCount(),e=d.gutter/100;return(d.chart.chartBBox[b?"width":"height"]-d[b?"xPadding":"yPadding"]*2)/(c*(e+1)-e)},getGutters:function(){var b=this,a=b.column,c=Math.ceil(b[a?"xPadding":"yPadding"]+b.getBarGirth()/2);return b.column?[c,0]:[0,c]},getBounds:function(){var n=this,N=n.chart,b=N.getChartStore(),M=b.data.items,L,w,C,u=[].concat(n.yField),o=u.length,k=o,c=n.groupGutter/100,G=n.column,g=n.xPadding,l=n.yPadding,I=n.stacked,s=n.getBarGirth(),x=G?"width":"height",t=Math,A=t.min,h=t.max,m=t.abs,F=n.getAxesForXAndYFields(),z=F.yAxis,K,B,e,p,E,q,r,D,y,a,v,H,J,d,f;n.setBBox(true);p=n.bbox;if(n.__excludes){for(J=0,v=n.__excludes.length;J<v;J++){if(n.__excludes[J]){k--}}}r=N.axes.get(z);if(r){K=r.applyData();E=K.from;q=K.to}if(n.yField&&!Ext.isNumber(E)){D=n.getMinMaxYValues();E=D[0];q=D[1]}if(!Ext.isNumber(E)){E=0}if(!Ext.isNumber(q)){q=0}y=(G?p.height-l*2:p.width-g*2)/(q-E);B=s;e=(s/((I?1:k)*(c+1)-c));if(x in n.style){e=A(e,n.style[x]);B=e*((I?1:k)*(c+1)-c)}a=(G)?p.y+p.height-l:p.x+g;if(I){v=[[],[]];for(L=0,w=M.length;L<w;L++){C=M[L];v[0][L]=v[0][L]||0;v[1][L]=v[1][L]||0;for(J=0;J<o;J++){if(n.__excludes&&n.__excludes[J]){continue}H=C.get(u[J]);v[+(H>0)][L]+=m(H)}}v[+(q>0)].push(m(q));v[+(E>0)].push(m(E));f=h.apply(t,v[0]);d=h.apply(t,v[1]);y=(G?p.height-l*2:p.width-g*2)/(d+f);a=a+f*y*(G?-1:1)}else{if(E/q<0){a=a-E*y*(G?-1:1)}}return{bars:u,bbox:p,shrunkBarWidth:B,barsLen:o,groupBarsLen:k,barWidth:s,groupBarWidth:e,scale:y,zero:a,xPadding:g,yPadding:l,signed:E/q<0,minY:E,maxY:q}},getPaths:function(){var u=this,W=u.chart,b=W.getChartStore(),V=b.data.items,U,D,K,F=u.bounds=u.getBounds(),y=u.items=[],O=u.yField,k=u.gutter/100,c=u.groupGutter/100,S=W.animate,M=u.column,w=u.group,l=W.shadow,Q=u.shadowGroups,P=u.shadowAttributes,p=Q.length,x=F.bbox,A=F.barWidth,J=F.shrunkBarWidth,m=u.xPadding,q=u.yPadding,R=u.stacked,v=F.barsLen,N=u.colorArrayStyle,g=N&&N.length||0,B=Math,n=B.max,H=B.min,t=B.abs,T,X,e,I,C,a,h,s,r,o,f,d,E,z,L,G;for(U=0,D=V.length;U<D;U++){K=V[U];a=F.zero;h=F.zero;I=0;C=0;s=false;for(T=0,f=0;T<v;T++){if(u.__excludes&&u.__excludes[T]){continue}X=K.get(F.bars[T]);e=Math.round((X-n(F.minY,0))*F.scale);r={fill:N[(v>1?T:0)%g]};if(M){Ext.apply(r,{height:e,width:n(F.groupBarWidth,0),x:(x.x+m+(A-J)*0.5+U*A*(1+k)+f*F.groupBarWidth*(1+c)*!R),y:a-e})}else{L=(D-1)-U;Ext.apply(r,{height:n(F.groupBarWidth,0),width:e+(a==F.zero),x:a+(a!=F.zero),y:(x.y+q+(A-J)*0.5+L*A*(1+k)+f*F.groupBarWidth*(1+c)*!R+1)})}if(e<0){if(M){r.y=h;r.height=t(e)}else{r.x=h+e;r.width=t(e)}}if(R){if(e<0){h+=e*(M?-1:1)}else{a+=e*(M?-1:1)}I+=t(e);if(e<0){C+=t(e)}}r.x=Math.floor(r.x)+1;G=Math.floor(r.y);if(!Ext.isIE9&&r.y>G){G--}r.y=G;r.width=Math.floor(r.width);r.height=Math.floor(r.height);y.push({series:u,yField:O[T],storeItem:K,value:[K.get(u.xField),X],attr:r,point:M?[r.x+r.width/2,X>=0?r.y:r.y+r.height]:[X>=0?r.x+r.width:r.x,r.y+r.height/2]});if(S&&W.resizing){o=M?{x:r.x,y:F.zero,width:r.width,height:0}:{x:F.zero,y:r.y,width:0,height:r.height};if(l&&(R&&!s||!R)){s=true;for(d=0;d<p;d++){E=Q[d].getAt(R?U:(U*v+T));if(E){E.setAttributes(o,true)}}}z=w.getAt(U*v+T);if(z){z.setAttributes(o,true)}}f++}if(R&&y.length){y[U*f].totalDim=I;y[U*f].totalNegDim=C}}},renderShadows:function(t,u,x,k){var y=this,o=y.chart,r=o.surface,f=o.animate,w=y.stacked,a=y.shadowGroups,v=y.shadowAttributes,n=a.length,g=o.getChartStore(),d=y.column,q=y.items,b=[],l=k.zero,e,p,h,z,m,s,c;if((w&&(t%k.groupBarsLen===0))||!w){s=t/k.groupBarsLen;for(e=0;e<n;e++){p=Ext.apply({},v[e]);h=a[e].getAt(w?s:t);Ext.copyTo(p,u,"x,y,width,height");if(!h){h=r.add(Ext.apply({type:"rect",group:a[e]},Ext.apply({},x,p)))}if(w){z=q[t].totalDim;m=q[t].totalNegDim;if(d){p.y=l+m-z-1;p.height=z}else{p.x=l-m;p.width=z}}c=y.renderer(h,g.getAt(s),p,t,g);c.hidden=!!u.hidden;if(f){y.onAnimate(h,{to:c})}else{h.setAttributes(c,true)}b.push(h)}}return b},drawSeries:function(){var B=this,q=B.chart,l=q.getChartStore(),u=q.surface,h=q.animate,z=B.stacked,d=B.column,b=q.shadow,a=B.shadowGroups,p=a.length,n=B.group,f=B.seriesStyle,r,o,x,w,A,s,c,e,g,m,k,y,t,v;if(!l||!l.getCount()||B.seriesIsHidden){B.hide();B.items=[];return}k=Ext.apply({},this.style,f);delete k.fill;delete k.x;delete k.y;delete k.width;delete k.height;B.unHighlightItem();B.cleanHighlights();B.getPaths();m=B.bounds;r=B.items;A=d?{y:m.zero,height:0}:{x:m.zero,width:0};o=r.length;for(x=0;x<o;x++){s=n.getAt(x);y=r[x].attr;if(b){r[x].shadows=B.renderShadows(x,y,A,m)}if(!s){t=Ext.apply({},A,y);t=Ext.apply(t,k||{});s=u.add(Ext.apply({},{type:"rect",group:n},t))}if(h){c=B.renderer(s,l.getAt(x),y,x,l);s._to=c;v=B.onAnimate(s,{to:Ext.apply(c,k)});if(b&&z&&(x%m.barsLen===0)){w=x/m.barsLen;for(e=0;e<p;e++){v.on("afteranimate",function(){this.show(true)},a[e].getAt(w))}}}else{c=B.renderer(s,l.getAt(x),Ext.apply(y,{hidden:false}),x,l);s.setAttributes(Ext.apply(c,k),true)}r[x].sprite=s}o=n.getCount();for(w=x;w<o;w++){n.getAt(w).hide(true)}if(B.stacked){x=l.getCount()}if(b){for(e=0;e<p;e++){g=a[e];o=g.getCount();for(w=x;w<o;w++){g.getAt(w).hide(true)}}}B.renderLabels()},onCreateLabel:function(e,k,d,f){var g=this,a=g.chart.surface,j=g.labelsGroup,b=g.label,c=Ext.apply({},b,g.seriesLabelStyle||{}),h;return a.add(Ext.apply({type:"text",group:j},c||{}))},onPlaceLabel:function(F,M,r,I,o,G,H,u){var l=this,m=l.bounds,d=m.groupBarWidth,E=l.column,K=l.chart,t=K.chartBBox,z=K.resizing,n=r.value[0],N=r.value[1],k=r.attr,w=l.label,J=w.orientation=="vertical",g=[].concat(w.field),s=w.renderer,q=s(M.get(g[u])),f=l.getLabelSize(q),a=f.width,c=f.height,b=m.zero,h="outside",p="insideStart",L="insideEnd",D=10,B=6,e=m.signed,C,A,v;F.setAttributes({text:q});F.isOutside=false;if(E){if(o==h){if(c+B+k.height>(N>=0?b-t.y:t.y+t.height-b)){o=L}}else{if(c+B>k.height){o=h;F.isOutside=true}}C=k.x+d/2;A=o==p?(b+((c/2+3)*(N>=0?-1:1))):(N>=0?(k.y+((c/2+3)*(o==h?-1:1))):(k.y+k.height+((c/2+3)*(o===h?1:-1))))}else{if(o==h){if(a+D+k.width>(N>=0?t.x+t.width-b:b-t.x)){o=L}}else{if(a+D>k.width){o=h;F.isOutside=true}}C=o==p?(b+((a/2+5)*(N>=0?1:-1))):(N>=0?(k.x+k.width+((a/2+5)*(o===h?1:-1))):(k.x+((a/2+5)*(o===h?-1:1))));A=k.y+d/2}v={x:C,y:A};if(J){v.rotate={x:C,y:A,degrees:270}}if(G&&z){if(E){C=k.x+k.width/2;A=b}else{C=b;A=k.y+k.height/2}F.setAttributes({x:C,y:A},true);if(J){F.setAttributes({rotate:{x:C,y:A,degrees:270}},true)}}if(G){l.onAnimate(F,{to:v})}else{F.setAttributes(Ext.apply(v,{hidden:false}),true)}},getLabelSize:function(f){var j=this.testerLabel,a=this.label,d=Ext.apply({},a,this.seriesLabelStyle||{}),b=a.orientation==="vertical",i,g,e,c;if(!j){j=this.testerLabel=this.chart.surface.add(Ext.apply({type:"text",opacity:0},d))}j.setAttributes({text:f},true);i=j.getBBox();g=i.width;e=i.height;return{width:b?e:g,height:b?g:e}},onAnimate:function(b,a){b.show();return this.callParent(arguments)},isItemInPoint:function(a,d,b){var c=b.sprite.getBBox();return c.x<=a&&c.y<=d&&(c.x+c.width)>=a&&(c.y+c.height)>=d},hideAll:function(a){var e=this.chart.axes,c=e.items,d=c.length,b=0;a=(isNaN(this._index)?a:this._index)||0;if(!this.__excludes){this.__excludes=[]}this.__excludes[a]=true;this.drawSeries();for(b;b<d;b++){c[b].drawAxis()}},showAll:function(a){var e=this.chart.axes,c=e.items,d=c.length,b=0;a=(isNaN(this._index)?a:this._index)||0;if(!this.__excludes){this.__excludes=[]}this.__excludes[a]=false;this.drawSeries();for(b;b<d;b++){c[b].drawAxis()}},getLegendColor:function(a){var c=this,b=c.colorArrayStyle.length;if(c.style&&c.style.fill){return c.style.fill}else{return c.colorArrayStyle[a%b]}},highlightItem:function(a){this.callParent(arguments);this.renderLabels()},unHighlightItem:function(){this.callParent(arguments);this.renderLabels()},cleanHighlights:function(){this.callParent(arguments);this.renderLabels()}});