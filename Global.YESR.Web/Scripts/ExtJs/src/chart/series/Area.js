Ext.define("Ext.chart.series.Area",{extend:"Ext.chart.series.Cartesian",alias:"series.area",requires:["Ext.chart.axis.Axis","Ext.draw.Color","Ext.fx.Anim"],type:"area",stacked:true,style:{},constructor:function(c){this.callParent(arguments);var e=this,a=e.chart.surface,d,b;c.highlightCfg=Ext.Object.merge({},{lineWidth:3,stroke:"#55c",opacity:0.8,color:"#f00"},c.highlightCfg);Ext.apply(e,c,{__excludes:[]});if(e.highlight){e.highlightSprite=a.add({type:"path",path:["M",0,0],zIndex:1000,opacity:0.3,lineWidth:5,hidden:true,stroke:"#444"})}e.group=a.getGroup(e.seriesId)},shrink:function(b,m,n){var h=b.length,l=Math.floor(h/n),g,f,d=0,k=this.areas.length,a=[],e=[],c=[];for(f=0;f<k;++f){a[f]=0}for(g=0;g<h;++g){d+=+b[g];for(f=0;f<k;++f){a[f]+=+m[g][f]}if(g%l==0){e.push(d/l);for(f=0;f<k;++f){a[f]/=l}c.push(a);d=0;for(f=0,a=[];f<k;++f){a[f]=0}}}return{x:e,y:c}},getBounds:function(){var h=this,L=h.chart,a=L.getChartStore(),K=a.data.items,H,E,w,u=[].concat(h.yField),z=u.length,y=[],C=[],f=Infinity,B=f,A=f,m=-f,k=-f,r=Math,v=r.min,e=r.max,o=h.getAxesForXAndYFields(),I=o.xAxis,t=o.yAxis,F,q,j,g,D,p,M,J,b,s,G,c,d,n,x;h.setBBox();j=h.bbox;if(n=L.axes.get(I)){if(n.type==="Time"){q=true}F=n.applyData();B=F.from;m=F.to}if(n=L.axes.get(t)){F=n.applyData();A=F.from;k=F.to}if(h.xField&&!Ext.isNumber(B)){n=h.getMinMaxXValues();q=true;B=n[0];m=n[1]}if(h.yField&&!Ext.isNumber(A)){n=h.getMinMaxYValues();A=n[0];k=n[1]}if(!Ext.isNumber(A)){A=0}if(!Ext.isNumber(k)){k=0}for(H=0,E=K.length;H<E;H++){w=K[H];p=w.get(h.xField);M=[];if(typeof p!="number"){if(q){p=+p}else{p=H}}y.push(p);b=0;for(J=0;J<z;J++){if(h.__excludes[J]){continue}d=w.get(u[J]);if(typeof d=="number"){A=v(A,d);M.push(d);b+=d}}B=v(B,p);m=e(m,p);k=e(k,b);C.push(M)}g=j.width/((m-B)||1);D=j.height/((k-A)||1);s=y.length;if((s>j.width)&&h.areas){G=h.shrink(y,C,j.width);y=G.x;C=G.y}return{bbox:j,minX:B,minY:A,xValues:y,yValues:C,xScale:g,yScale:D,areasLen:z}},getPaths:function(){var v=this,l=v.chart,c=l.getChartStore(),e=true,f=v.getBounds(),a=f.bbox,m=v.items=[],u=[],b,d=0,o=[],r,h,j,g,p,s,k,w,q,t,n;h=f.xValues.length;for(r=0;r<h;r++){p=f.xValues[r];s=f.yValues[r];j=a.x+(p-f.minX)*f.xScale;k=0;d=0;for(w=0;w<f.areasLen;w++){if(v.__excludes[w]){continue}if(!u[w]){u[w]=[]}t=s[d];k+=t;g=a.y+a.height-(k-f.minY)*f.yScale;if(!o[w]){o[w]=["M",j,g];u[w].push(["L",j,g])}else{o[w].push("L",j,g);u[w].push(["L",j,g])}if(!m[w]){m[w]={pointsUp:[],pointsDown:[],series:v}}m[w].pointsUp.push([j,g]);d++}}for(w=0;w<f.areasLen;w++){if(v.__excludes[w]){continue}n=o[w];if(w==0||e){e=false;n.push("L",j,a.y+a.height,"L",a.x,a.y+a.height,"Z")}else{b=u[q];b.reverse();n.push("L",j,b[0][2]);for(r=0;r<h;r++){n.push(b[r][0],b[r][1],b[r][2]);m[w].pointsDown[h-r-1]=[b[r][1],b[r][2]]}n.push("L",a.x,n[2],"Z")}q=w}return{paths:o,areasLen:f.areasLen}},drawSeries:function(){var g=this,f=g.chart,h=f.getChartStore(),c=f.surface,b=f.animate,j=g.group,a=Ext.apply(g.seriesStyle,g.style),k=g.colorArrayStyle,n=k&&k.length||0,d,e,m,l,i;g.unHighlightItem();g.cleanHighlights();if(!h||!h.getCount()||g.seriesIsHidden){g.hide();g.items=[];return}m=g.getPaths();if(!g.areas){g.areas=[]}for(d=0;d<m.areasLen;d++){if(g.__excludes[d]){continue}if(!g.areas[d]){g.items[d].sprite=g.areas[d]=c.add(Ext.apply({},{type:"path",group:j,path:m.paths[d],stroke:a.stroke||k[d%n],fill:k[d%n]},a||{}))}e=g.areas[d];l=m.paths[d];if(b){i=g.renderer(e,false,{path:l,fill:k[d%n],stroke:a.stroke||k[d%n]},d,h);g.animation=g.onAnimate(e,{to:i})}else{i=g.renderer(e,false,{path:l,hidden:false,fill:k[d%n],stroke:a.stroke||k[d%n]},d,h);g.areas[d].setAttributes(i,true)}}g.renderLabels();g.renderCallouts()},onAnimate:function(b,a){b.show();return this.callParent(arguments)},onCreateLabel:function(d,j,c,e){var f=this,g=f.labelsGroup,a=f.label,h=f.bbox,b=Ext.apply(a,f.seriesLabelStyle);return f.chart.surface.add(Ext.apply({type:"text","text-anchor":"middle",group:g,x:j.point[0],y:h.y+h.height/2},b||{}))},onPlaceLabel:function(f,j,r,o,n,c,e){var t=this,k=t.chart,q=k.resizing,s=t.label,p=s.renderer,b=s.field,a=t.bbox,h=r.point[0],g=r.point[1],d,m,l;f.setAttributes({text:p(j.get(b[e])),hidden:true},true);d=f.getBBox();m=d.width/2;l=d.height/2;h=h-m<a.x?a.x+m:h;h=(h+m>a.x+a.width)?(h-(h+m-a.x-a.width)):h;g=g-l<a.y?a.y+l:g;g=(g+l>a.y+a.height)?(g-(g+l-a.y-a.height)):g;if(t.chart.animate&&!t.chart.resizing){f.show(true);t.onAnimate(f,{to:{x:h,y:g}})}else{f.setAttributes({x:h,y:g},true);if(q){t.animation.on("afteranimate",function(){f.show(true)})}else{f.show(true)}}},onPlaceCallout:function(l,q,I,F,E,d,j){var L=this,r=L.chart,C=r.surface,G=r.resizing,K=L.callouts,s=L.items,u=(F==0)?false:s[F-1].point,w=(F==s.length-1)?false:s[F+1].point,c=I.point,z,f,M,J,n,o,b=l.label.getBBox(),H=30,B=10,A=3,g,e,h,v,t,D=L.clipRect,m,k;if(!u){u=c}if(!w){w=c}J=(w[1]-u[1])/(w[0]-u[0]);n=(c[1]-u[1])/(c[0]-u[0]);o=(w[1]-c[1])/(w[0]-c[0]);f=Math.sqrt(1+J*J);z=[1/f,J/f];M=[-z[1],z[0]];if(n>0&&o<0&&M[1]<0||n<0&&o>0&&M[1]>0){M[0]*=-1;M[1]*=-1}else{if(Math.abs(n)<Math.abs(o)&&M[0]<0||Math.abs(n)>Math.abs(o)&&M[0]>0){M[0]*=-1;M[1]*=-1}}m=c[0]+M[0]*H;k=c[1]+M[1]*H;g=m+(M[0]>0?0:-(b.width+2*A));e=k-b.height/2-A;h=b.width+2*A;v=b.height+2*A;if(g<D[0]||(g+h)>(D[0]+D[2])){M[0]*=-1}if(e<D[1]||(e+v)>(D[1]+D[3])){M[1]*=-1}m=c[0]+M[0]*H;k=c[1]+M[1]*H;g=m+(M[0]>0?0:-(b.width+2*A));e=k-b.height/2-A;h=b.width+2*A;v=b.height+2*A;l.lines.setAttributes({path:["M",c[0],c[1],"L",m,k,"Z"]},true);l.box.setAttributes({x:g,y:e,width:h,height:v},true);l.label.setAttributes({x:m+(M[0]>0?A:-(b.width+A)),y:k},true);for(t in l){l[t].show(true)}},isItemInPoint:function(h,g,l,c){var f=this,b=l.pointsUp,d=l.pointsDown,o=Math.abs,n=false,k=false,e=Infinity,a,m,j;for(a=0,m=b.length;a<m;a++){j=[b[a][0],b[a][1]];n=false;k=a==m-1;if(e>o(h-j[0])){e=o(h-j[0]);n=true;if(k){++a}}if(!n||(n&&k)){j=b[a-1];if(g>=j[1]&&(!d.length||g<=(d[a-1][1]))){l.storeIndex=a-1;l.storeField=f.yField[c];l.storeItem=f.chart.store.getAt(a-1);l._points=d.length?[j,d[a-1]]:[j];return true}else{break}}}return false},highlightSeries:function(){var a,c,b;if(this._index!==undefined){a=this.areas[this._index];if(a.__highlightAnim){a.__highlightAnim.paused=true}a.__highlighted=true;a.__prevOpacity=a.__prevOpacity||a.attr.opacity||1;a.__prevFill=a.__prevFill||a.attr.fill;a.__prevLineWidth=a.__prevLineWidth||a.attr.lineWidth;b=Ext.draw.Color.fromString(a.__prevFill);c={lineWidth:(a.__prevLineWidth||0)+2};if(b){c.fill=b.getLighter(0.2).toString()}else{c.opacity=Math.max(a.__prevOpacity-0.3,0)}if(this.chart.animate){a.__highlightAnim=new Ext.fx.Anim(Ext.apply({target:a,to:c},this.chart.animate))}else{a.setAttributes(c,true)}}},unHighlightSeries:function(){var a;if(this._index!==undefined){a=this.areas[this._index];if(a.__highlightAnim){a.__highlightAnim.paused=true}if(a.__highlighted){a.__highlighted=false;a.__highlightAnim=new Ext.fx.Anim({target:a,to:{fill:a.__prevFill,opacity:a.__prevOpacity,lineWidth:a.__prevLineWidth}})}}},highlightItem:function(c){var b=this,a,d;if(!c){this.highlightSeries();return}a=c._points;d=a.length==2?["M",a[0][0],a[0][1],"L",a[1][0],a[1][1]]:["M",a[0][0],a[0][1],"L",a[0][0],b.bbox.y+b.bbox.height];b.highlightSprite.setAttributes({path:d,hidden:false},true)},unHighlightItem:function(a){if(!a){this.unHighlightSeries()}if(this.highlightSprite){this.highlightSprite.hide(true)}},hideAll:function(a){var b=this;a=(isNaN(b._index)?a:b._index)||0;b.__excludes[a]=true;b.areas[a].hide(true);b.redraw()},showAll:function(a){var b=this;a=(isNaN(b._index)?a:b._index)||0;b.__excludes[a]=false;b.areas[a].show(true);b.redraw()},redraw:function(){var a=this,b;b=a.chart.legend.rebuild;a.chart.legend.rebuild=false;a.chart.redraw();a.chart.legend.rebuild=b},hide:function(){if(this.areas){var g=this,b=g.areas,d,c,a,f,e;if(b&&b.length){for(d=0,f=b.length;d<f;++d){if(b[d]){b[d].hide(true)}}g.hideLabels()}}},getLegendColor:function(a){var b=this;return b.colorArrayStyle[a%b.colorArrayStyle.length]}});