Ext.define("Ext.chart.Label",{requires:["Ext.draw.Color"],colorStringRe:/url\s*\(\s*#([^\/)]+)\s*\)/,constructor:function(a){var b=this;b.label=Ext.applyIf(b.label||{},{display:"none",color:"#000",field:"name",minMargin:50,font:"11px Helvetica, sans-serif",orientation:"horizontal",renderer:function(c){return c}});if(b.label.display!=="none"){b.labelsGroup=b.chart.surface.getGroup(b.seriesId+"-labels")}},renderLabels:function(){var n=this,K=n.chart,w=K.gradients,q=n.items,G=K.animate,z=n.label,t=z.display,u=z.color,d=[].concat(z.field),p=n.labelsGroup,h=(p||0)&&p.length,b=n.chart.getChartStore(),o=b.getCount(),g=(q||0)&&q.length,C=g/o,y=(w||0)&&w.length,l=Ext.draw.Color,J=[],m,I,D,c,x,H,F,e,f,s,v,E,L,r,M,B,A,a;if(t=="none"){return}if(g==0){while(h--){J.push(h)}}else{for(I=0,D=0,c=0;I<o;I++){x=0;for(H=0;H<C;H++){v=q[D];E=p.getAt(c);L=b.getAt(I);while(this.__excludes&&this.__excludes[x]){x++}if(!v&&E){E.hide(true);c++}if(v&&d[H]){if(!E){E=n.onCreateLabel(L,v,I,t,H,x)}n.onPlaceLabel(E,L,v,I,t,G,H,x);c++;if(z.contrast&&v.sprite){r=v.sprite;if(r._endStyle){a=r._endStyle.fill}else{if(r._to){a=r._to.fill}else{a=r.attr.fill}}a=a||r.attr.fill;M=l.fromString(a);if(a&&!M){a=a.match(n.colorStringRe)[1];for(F=0;F<y;F++){m=w[F];if(m.id==a){s=0;e=0;for(f in m.stops){s++;e+=l.fromString(m.stops[f].color).getGrayscale()}B=(e/s)/255;break}}}else{B=M.getGrayscale()/255}if(E.isOutside){B=1}A=l.fromString(E.attr.color||E.attr.fill).getHSL();A[2]=B>0.5?0.2:0.8;E.setAttributes({fill:String(l.fromHSL.apply({},A))},true)}}D++;x++}}h=p.length;while(h>c){J.push(c);c++}}n.hideLabels(J)},hideLabels:function(b){var a=this.labelsGroup,c=!!b&&b.length;if(!a){return}if(c===false){c=a.getCount();while(c--){a.getAt(c).hide(true)}}else{while(c--){a.getAt(b[c]).hide(true)}}}});