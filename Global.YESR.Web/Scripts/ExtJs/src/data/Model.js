Ext.define("Ext.data.Model",{alternateClassName:"Ext.data.Record",mixins:{observable:"Ext.util.Observable"},requires:["Ext.ModelManager","Ext.data.IdGenerator","Ext.data.Field","Ext.data.Errors","Ext.data.Operation","Ext.data.validations","Ext.util.MixedCollection"],compareConvertFields:function(a,d){var c=a.convert&&a.type&&a.convert!==a.type.convert,b=d.convert&&d.type&&d.convert!==d.type.convert;if(c&&!b){return 1}if(!c&&b){return -1}return 0},itemNameFn:function(a){return a.name},onClassExtended:function(b,c,a){var d=a.onBeforeCreated;a.onBeforeCreated=function(f,B){var A=this,C=Ext.getClassName(f),p=f.prototype,v=f.prototype.superclass,g=B.validations||[],r=B.fields||[],w=B.associations||[],e=function(E,G){var F=0,D,H;if(E){E=Ext.Array.from(E);for(D=E.length;F<D;++F){H=E[F];if(!Ext.isObject(H)){H={model:H}}H.type=G;w.push(H)}}},s=B.idgen,y=new Ext.util.MixedCollection(false,p.itemNameFn),x=new Ext.util.MixedCollection(false,p.itemNameFn),o=v.validations,z=v.fields,k=v.associations,h,u,m,n=[],l=B.idProperty||f.prototype.idProperty,t=function(E,D,i){var F,G;if(y.events.add.firing){G=E;F=D}else{F=i;G=D.originalIndex}F.originalIndex=G;if(F.mapping===l||(F.mapping==null&&F.name===l)){F.defaultValue=undefined}},q=B.proxy||f.prototype.proxy||f.prototype.defaultProxyType,j=function(){y.sortBy(p.compareConvertFields)};f.modelName=C;p.modelName=C;if(o){g=o.concat(g)}B.validations=g;if(z){r=z.items.concat(r)}y.on({add:t,replace:t});for(u=0,m=r.length;u<m;++u){y.add(new Ext.data.Field(r[u]))}if(!y.get(l)){y.add(new Ext.data.Field(l))}j();y.on({add:j,replace:j});B.fields=y;if(s){B.idgen=Ext.data.IdGenerator.get(s)}e(B.belongsTo,"belongsTo");delete B.belongsTo;e(B.hasMany,"hasMany");delete B.hasMany;e(B.hasOne,"hasOne");delete B.hasOne;if(k){w=k.items.concat(w)}for(u=0,m=w.length;u<m;++u){n.push("association."+w[u].type.toLowerCase())}if(q&&!q.isProxy){n.push("proxy."+(typeof q==="string"?q:q.type))}Ext.require(n,function(){Ext.ModelManager.registerType(C,f);for(u=0,m=w.length;u<m;++u){h=w[u];Ext.apply(h,{ownerModel:C,associatedModel:h.model});if(Ext.ModelManager.getModel(h.model)===undefined){Ext.ModelManager.registerDeferredAssociation(h)}else{x.add(Ext.data.association.Association.create(h))}}B.associations=x;d.call(A,f,B,a);f.setProxy(q);Ext.ModelManager.onModelDefined(f)})}},inheritableStatics:{setProxy:function(a){if(!a.isProxy){if(typeof a=="string"){a={type:a}}a=Ext.createByAlias("proxy."+a.type,a)}a.setModel(this);this.proxy=this.prototype.proxy=a;return a},getProxy:function(){return this.proxy},setFields:function(c,d,b){var h=this,g=h.prototype,f=g.fields,a=c?c.length:0,e=0;if(d){g.idProperty=d}if(b){g.clientIdProperty=b}if(f){f.clear()}else{f=h.prototype.fields=new Ext.util.MixedCollection(false,function(i){return i.name})}for(;e<a;e++){f.add(new Ext.data.Field(c[e]))}if(!f.get(g.idProperty)){f.add(new Ext.data.Field(g.idProperty))}h.fields=f;return f},getFields:function(){return this.prototype.fields.items},load:function(f,c){c=Ext.apply({},c);c=Ext.applyIf(c,{action:"read",id:f});var b=new Ext.data.Operation(c),d=c.scope||this,a=null,e;e=function(g){if(g.wasSuccessful()){a=g.getRecords()[0];Ext.callback(c.success,d,[a,g])}else{Ext.callback(c.failure,d,[a,g])}Ext.callback(c.callback,d,[a,g])};this.proxy.read(b,e,this)}},statics:{PREFIX:"ext-record",AUTO_ID:1,EDIT:"edit",REJECT:"reject",COMMIT:"commit",id:function(a){var b=[this.PREFIX,"-",this.AUTO_ID++].join("");a.phantom=true;a.internalId=b;return b}},idgen:{isGenerator:true,type:"default",generate:function(){return null},getRecId:function(a){return a.modelName+"-"+a.internalId}},editing:false,dirty:false,persistenceProperty:"data",evented:false,isModel:true,phantom:false,idProperty:"id",clientIdProperty:null,defaultProxyType:"ajax",constructor:function(h,d,n,b){h=h||{};var k=this,j,e,l,a,m,f,c,g;k.internalId=(d||d===0)?d:Ext.data.Model.id(k);k.raw=n;if(!k.data){k.data={}}k.modified={};if(k.persistanceProperty){if(Ext.isDefined(Ext.global.console)){Ext.global.console.warn("Ext.data.Model: persistanceProperty has been deprecated. Use persistenceProperty instead.")}k.persistenceProperty=k.persistanceProperty}k[k.persistenceProperty]=b||{};k.mixins.observable.constructor.call(k);if(!b){j=k.fields.items;e=j.length;g=0;c=k[k.persistenceProperty];if(Ext.isArray(h)){for(;g<e;g++){l=j[g];a=l.name;m=h[g];if(m===undefined){m=l.defaultValue}if(l.convert){m=l.convert(m,k)}if(m!==undefined){c[a]=m}}}else{for(;g<e;g++){l=j[g];a=l.name;m=h[a];if(m===undefined){m=l.defaultValue}if(l.convert){m=l.convert(m,k)}if(m!==undefined){c[a]=m}}}}k.stores=[];if(k.getId()){k.phantom=false}else{if(k.phantom){f=k.idgen.generate();if(f!==null){k.setId(f)}}}k.dirty=false;k.modified={};if(typeof k.init=="function"){k.init()}k.id=k.idgen.getRecId(k)},get:function(a){return this[this.persistenceProperty][a]},_singleProp:{},set:function(q,b){var i=this,g=i[i.persistenceProperty],h=i.fields,p=i.modified,n=(typeof q=="string"),o,j,f,m,e,a,c,d,k,l;if(n){l=i._singleProp;l[q]=b}else{l=q}for(a in l){if(l.hasOwnProperty(a)){k=l[a];if(h&&(j=h.get(a))&&j.convert){k=j.convert(k,i)}o=g[a];if(i.isEqual(o,k)){continue}g[a]=k;(e||(e=[])).push(a);if(j&&j.persist){if(p.hasOwnProperty(a)){if(i.isEqual(p[a],k)){delete p[a];i.dirty=false;for(m in p){if(p.hasOwnProperty(m)){i.dirty=true;break}}}}else{i.dirty=true;p[a]=o}}if(a==i.idProperty){f=true;c=o;d=k}}}if(n){delete l[q]}if(f){i.fireEvent("idchanged",i,c,d)}if(!i.editing&&e){i.afterEdit(e)}return e||null},copyFrom:function(f){if(f){var e=this,c=e.fields.items,j=c.length,g,a=0,d=e[e.persistenceProperty],b=f[f.persistenceProperty],h;for(;a<j;a++){g=c[a];h=b[g.name];if(h!==undefined){d[g.name]=h}}if(e.phantom&&!f.phantom){e.setId(f.getId())}}},isEqual:function(d,c){if(Ext.isDate(d)&&Ext.isDate(c)){return Ext.Date.isEqual(d,c)}return d===c},beginEdit:function(){var a=this;if(!a.editing){a.editing=true;a.dirtySave=a.dirty;a.dataSave=Ext.apply({},a[a.persistenceProperty]);a.modifiedSave=Ext.apply({},a.modified)}},cancelEdit:function(){var a=this;if(a.editing){a.editing=false;a.modified=a.modifiedSave;a[a.persistenceProperty]=a.dataSave;a.dirty=a.dirtySave;delete a.modifiedSave;delete a.dataSave;delete a.dirtySave}},endEdit:function(a,c){var b=this,d;if(b.editing){b.editing=false;if(!c){c=b.getModifiedFieldNames()}d=b.dirty||c.length>0;delete b.modifiedSave;delete b.dataSave;delete b.dirtySave;if(d&&a!==true){b.afterEdit(c)}}},getModifiedFieldNames:function(){var d=this,c=d.dataSave,e=d[d.persistenceProperty],a=[],b;for(b in e){if(e.hasOwnProperty(b)){if(!d.isEqual(e[b],c[b])){a.push(b)}}}return a},getChanges:function(){var a=this.modified,b={},c;for(c in a){if(a.hasOwnProperty(c)){b[c]=this.get(c)}}return b},isModified:function(a){return this.modified.hasOwnProperty(a)},setDirty:function(){var c=this,a=c.fields.items,g=a.length,e,b,d;c.dirty=true;for(d=0;d<g;d++){e=a[d];if(e.persist){b=e.name;c.modified[b]=c.get(b)}}},markDirty:function(){if(Ext.isDefined(Ext.global.console)){Ext.global.console.warn("Ext.data.Model: markDirty has been deprecated. Use setDirty instead.")}return this.setDirty.apply(this,arguments)},reject:function(a){var c=this,b=c.modified,d;for(d in b){if(b.hasOwnProperty(d)){if(typeof b[d]!="function"){c[c.persistenceProperty][d]=b[d]}}}c.dirty=false;c.editing=false;c.modified={};if(a!==true){c.afterReject()}},commit:function(a){var b=this;b.phantom=b.dirty=b.editing=false;b.modified={};if(a!==true){b.afterCommit()}},copy:function(a){var b=this;return new b.self(Ext.apply({},b[b.persistenceProperty]),a)},setProxy:function(a){if(!a.isProxy){if(typeof a==="string"){a={type:a}}a=Ext.createByAlias("proxy."+a.type,a)}a.setModel(this.self);this.proxy=a;return a},getProxy:function(){return this.proxy},validate:function(){var j=new Ext.data.Errors(),c=this.validations,e=Ext.data.validations,b,d,h,a,g,f;if(c){b=c.length;for(f=0;f<b;f++){d=c[f];h=d.field||d.name;g=d.type;a=e[g](d,this.get(h));if(!a){j.add({field:h,message:d.message||e[g+"Message"]})}}}return j},isValid:function(){return this.validate().isValid()},save:function(l){l=Ext.apply({},l);var f=this,b=f.phantom?"create":"update",k=l.scope||f,h=f.stores,c=0,e,g,d,a,j;Ext.apply(l,{records:[f],action:b});a=new Ext.data.Operation(l);j=function(i){d=[f,i];if(i.wasSuccessful()){for(e=h.length;c<e;c++){g=h[c];g.fireEvent("write",g,i);g.fireEvent("datachanged",g)}Ext.callback(l.success,k,d)}else{Ext.callback(l.failure,k,d)}Ext.callback(l.callback,k,d)};f.getProxy()[b](a,j,f);return f},destroy:function(k){k=Ext.apply({},k);var e=this,j=k.scope||e,g=e.stores,b=0,d,f,c,a,h;Ext.apply(k,{records:[e],action:"destroy"});a=new Ext.data.Operation(k);h=function(i){c=[e,i];if(i.wasSuccessful()){for(d=g.length;b<d;b++){f=g[b];f.fireEvent("write",f,i);f.fireEvent("datachanged",f)}e.clearListeners();Ext.callback(k.success,j,c)}else{Ext.callback(k.failure,j,c)}Ext.callback(k.callback,j,c)};e.getProxy().destroy(a,h,e);return e},getId:function(){return this.get(this.idProperty)},getObservableId:function(){return this.id},setId:function(a){this.set(this.idProperty,a);this.phantom=!(a||a===0)},join:function(a){Ext.Array.include(this.stores,a);this.store=this.stores[0]},unjoin:function(a){Ext.Array.remove(this.stores,a);this.store=this.stores[0]||null},afterEdit:function(a){this.callStore("afterEdit",a)},afterReject:function(){this.callStore("afterReject")},afterCommit:function(){this.callStore("afterCommit")},callStore:function(f){var d=Ext.Array.clone(arguments),b=this.stores,e=0,a=b.length,c,g;d[0]=this;for(;e<a;++e){c=b[e];if(c&&typeof c[f]=="function"){c[f].apply(c,d)}g=c.treeStore;if(g&&typeof g[f]=="function"){g[f].apply(g,d)}}},getData:function(c){var d=this,a=d.fields.items,h=a.length,g={},b,e;for(e=0;e<h;e++){b=a[e].name;g[b]=d.get(b)}if(c===true){Ext.apply(g,d.getAssociatedData())}return g},getAssociatedData:function(){return this.prepareAssociatedData({},1)},prepareAssociatedData:function(v,y){var x=this,s=x.associations.items,e=s.length,w={},p=[],u=[],l=[],n,b,a,m,f,k,h,t,g,c,r,q,d,z;for(r=0;r<e;r++){c=s[r];t=c.associationId;h=v[t];if(h&&h!==y){continue}v[t]=y;d=c.type;z=c.name;if(d=="hasMany"){n=x[c.storeName];w[z]=[];if(n&&n.getCount()>0){b=n.data.items;g=b.length;for(q=0;q<g;q++){a=b[q];w[z][q]=a.getData();p.push(a);u.push(z);l.push(q)}}}else{if(d=="belongsTo"||d=="hasOne"){a=x[c.instanceName];if(a!==undefined){w[z]=a.getData();p.push(a);u.push(z);l.push(-1)}}}}for(r=0,g=p.length;r<g;++r){a=p[r];m=w[u[r]];f=l[r];k=a.prepareAssociatedData(v,y+1);if(f===-1){Ext.apply(m,k)}else{Ext.apply(m[f],k)}}return w}});