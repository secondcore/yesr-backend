Ext.define("Ext.data.reader.Reader",{requires:["Ext.data.ResultSet"],alternateClassName:["Ext.data.Reader","Ext.data.DataReader"],mixins:{observable:"Ext.util.Observable"},totalProperty:"total",successProperty:"success",root:"",implicitIncludes:true,readRecordsOnFailure:true,isReader:true,applyDefaults:true,constructor:function(a){var b=this;b.mixins.observable.constructor.call(b,a);b.fieldCount=0;b.model=Ext.ModelManager.getModel(b.model);if(b.model&&b.model.prototype.fields){b.buildExtractors()}this.addEvents("exception")},setModel:function(a,c){var b=this;b.model=Ext.ModelManager.getModel(a);b.buildExtractors(true);if(c&&b.proxy){b.proxy.setModel(b.model,true)}},read:function(a){var b;if(a){b=a.responseText?this.getResponseData(a):this.readRecords(a)}return b||this.nullResultSet},readRecords:function(c){var d=this,h,b,a,f,e,g,i;if(d.fieldCount!==d.getFields().length){d.buildExtractors(true)}d.rawData=c;c=d.getData(c);h=true;b=0;a=[];if(d.successProperty){g=d.getSuccess(c);if(g===false||g==="false"){h=false}}if(d.messageProperty){i=d.getMessage(c)}if(d.readRecordsOnFailure||h){f=Ext.isArray(c)?c:d.getRoot(c);if(f){e=f.length}if(d.totalProperty){g=parseInt(d.getTotal(c),10);if(!isNaN(g)){e=g}}if(f){a=d.extractData(f);b=a.length}}return new Ext.data.ResultSet({total:e||b,count:b,records:a,success:h,message:i})},extractData:function(j){var h=this,d=[],b=h.model,a=j.length,e,c,g,f;if(!j.length&&Ext.isObject(j)){j=[j];a=1}for(f=0;f<a;f++){c=j[f];g=new b(undefined,h.getId(c),c,e={});g.phantom=false;h.convertRecordData(e,c,g);d.push(g);if(h.implicitIncludes){h.readAssociated(g,c)}}return d},readAssociated:function(g,e){var d=g.associations.items,f=0,a=d.length,c,b,j,h;for(;f<a;f++){c=d[f];b=this.getAssociatedDataRoot(e,c.associationKey||c.name);if(b){h=c.getReader();if(!h){j=c.associatedModel.proxy;if(j){h=j.getReader()}else{h=new this.constructor({model:c.associatedName})}}c.read(g,h,b)}}},getAssociatedDataRoot:function(b,a){return b[a]},getFields:function(){return this.model.prototype.fields.items},getData:function(a){return a},getRoot:function(a){return a},getResponseData:function(a){Ext.Error.raise("getResponseData must be implemented in the Ext.data.reader.Reader subclass")},onMetaChange:function(e){var d=this,b=e.fields||d.getFields(),c,a;d.metaData=e;d.root=e.root||d.root;d.idProperty=e.idProperty||d.idProperty;d.totalProperty=e.totalProperty||d.totalProperty;d.successProperty=e.successProperty||d.successProperty;d.messageProperty=e.messageProperty||d.messageProperty;a=e.clientIdProperty;if(d.model){d.model.setFields(b,d.idProperty,a);d.setModel(d.model,true)}else{c=Ext.define("Ext.data.reader.Json-Model"+Ext.id(),{extend:"Ext.data.Model",fields:b,clientIdProperty:a});if(d.idProperty){c.idProperty=d.idProperty}d.setModel(c,true)}},getIdProperty:function(){return this.idProperty||this.model.prototype.idProperty},buildExtractors:function(b){var f=this,i=f.getIdProperty(),h=f.totalProperty,e=f.successProperty,g=f.messageProperty,d,c,a;if(b===true){delete f.convertRecordData}if(f.convertRecordData){return}if(h){f.getTotal=f.createAccessor(h)}if(e){f.getSuccess=f.createAccessor(e)}if(g){f.getMessage=f.createAccessor(g)}if(i){c=f.model.prototype.fields.get(i);if(c){a=c.mapping;i=(a!==undefined&&a!==null)?a:i}d=f.createAccessor(i);f.getId=function(j){var k=d.call(f,j);return(k===undefined||k==="")?null:k}}else{f.getId=function(){return null}}f.convertRecordData=f.buildRecordDataExtractor()},buildRecordDataExtractor:function(){var h=this,k=h.model.prototype,g=k.clientIdProperty,f=k.fields.items,d=f.length,a=[],c,e=0,j,b=["var me = this,\n","    fields = me.model.prototype.fields,\n","    value,\n","    internalId"];for(e=0;e<d;e++){j=f[e];a[e]="__field"+e;b.push(",\n    ",a[e],' = fields.get("',j.name,'")')}b.push(";\n\n    return function(dest, source, record) {\n");for(e=0;e<d;e++){j=f[e];c=a[e];b.push("        value = ",h.createFieldAccessExpression(j,c,"source"),";\n");if(j.defaultValue!==undefined){b.push("        if (value === undefined) {\n");b.push("            if (me.applyDefaults) {\n");b.push('                dest["'+j.name+'"] = ',(j.convert?a[e]+".convert("+a[e]+".defaultValue, record)":(a[e]+".defaultValue")),";\n");b.push("            }\n");b.push("        } else {\n");b.push('            dest["'+j.name+'"] = ',(j.convert?a[e]+".convert(value, record)":"value"),";\n");b.push("        }\n")}else{b.push("        if (value !== undefined) {\n");b.push('            dest["'+j.name+'"] = ',(j.convert?a[e]+".convert(value, record)":"value"),";\n");b.push("        }\n")}}if(g){b.push("        if (record && (internalId = "+h.createFieldAccessExpression({mapping:g},null,"source")+")) {\n");b.push("            record.internalId = internalId;\n        }\n")}b.push("    };");return Ext.functionFactory(b.join("")).call(h)},destroyReader:function(){var a=this;delete a.proxy;delete a.model;delete a.convertRecordData;delete a.getId;delete a.getTotal;delete a.getSuccess;delete a.getMessage}},function(){Ext.apply(this.prototype,{nullResultSet:new Ext.data.ResultSet({total:0,count:0,records:[],success:true})})});