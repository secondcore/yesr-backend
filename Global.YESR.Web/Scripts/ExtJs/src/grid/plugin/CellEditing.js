Ext.define("Ext.grid.plugin.CellEditing",{alias:"plugin.cellediting",extend:"Ext.grid.plugin.Editing",requires:["Ext.grid.CellEditor","Ext.util.DelayedTask"],constructor:function(){this.callParent(arguments);this.editors=new Ext.util.MixedCollection(false,function(a){return a.editorId});this.editTask=new Ext.util.DelayedTask()},onReconfigure:function(){this.editors.clear();this.callParent()},destroy:function(){var a=this;a.editTask.cancel();a.editors.each(Ext.destroy,Ext);a.editors.clear();a.callParent(arguments)},onBodyScroll:function(){var c=this,b=c.getActiveEditor(),a=c.view.el.getScroll();if(b&&b.editing){if(a.top!==c.scroll.top){if(b.field){if(b.field.triggerBlur){b.field.triggerBlur()}else{b.field.blur()}}}else{b.realign()}}c.scroll=a},initCancelTriggers:function(){var c=this,b=c.grid,a=b.view;a.addElListener("mousewheel",c.cancelEdit,c);c.mon(a,"bodyscroll",c.onBodyScroll,c);c.mon(b,{columnresize:c.cancelEdit,columnmove:c.cancelEdit,scope:c})},isCellEditable:function(a,d){var c=this,b=c.getEditingContext(a,d);if(c.grid.view.isVisible(true)&&b){d=b.column;a=b.record;if(d&&c.getEditor(a,d)){return true}}},startEdit:function(a,f){var d=this,c=d.getEditingContext(a,f),e,b;d.completeEdit();if(!c||!d.grid.view.isVisible(true)){return false}a=c.record;f=c.column;if(f&&!f.getEditor(a)){return false}e=a.get(f.dataIndex);c.originalValue=c.value=e;if(d.beforeEdit(c)===false||d.fireEvent("beforeedit",d,c)===false||c.cancel){return false}b=d.getEditor(a,f);d.grid.view.cancelFocus();d.view.focusCell({row:c.row,column:c.colIdx});if(b){d.context=c;d.setActiveEditor(b);d.setActiveRecord(a);d.setActiveColumn(f);d.editTask.delay(15,b.startEdit,b,[d.getCell(a,f),e]);d.editing=true;d.scroll=d.view.el.getScroll();return true}return false},completeEdit:function(){var a=this.getActiveEditor();if(a){a.completeEdit();this.editing=false}},setActiveEditor:function(a){this.activeEditor=a},getActiveEditor:function(){return this.activeEditor},setActiveColumn:function(a){this.activeColumn=a},getActiveColumn:function(){return this.activeColumn},setActiveRecord:function(a){this.activeRecord=a},getActiveRecord:function(){return this.activeRecord},getEditor:function(a,d){var f=this,e=f.editors,c=d.getItemId(),b=e.getByKey(c);if(b){return b}else{b=d.getEditor(a);if(!b){return false}if(!(b instanceof Ext.grid.CellEditor)){b=new Ext.grid.CellEditor({editorId:c,field:b,ownerCt:f.grid})}b.editingPlugin=f;b.isForTree=f.grid.isTree;b.on({scope:f,specialkey:f.onSpecialKey,complete:f.onEditComplete,canceledit:f.cancelEdit});e.add(b);return b}},setColumnField:function(b,c){var a=this.editors.getByKey(b.getItemId());Ext.destroy(a,b.field);this.editors.removeAtKey(b.getItemId());this.callParent(arguments)},getCell:function(a,b){return this.grid.getView().getCell(a,b)},onSpecialKey:function(a,f,d){var c=this,b=c.grid,g;if(d.getKey()===d.TAB){d.stopEvent();if(a){a.onEditorTab(d)}g=b.getSelectionModel();if(g.onEditorTab){g.onEditorTab(c,d)}}},onEditComplete:function(c,g,b){var f=this,d=f.grid,e=f.getActiveColumn(),a;if(e){a=f.context.record;f.setActiveEditor(null);f.setActiveColumn(null);f.setActiveRecord(null);if(!f.validateEdit()){return}if(!a.isEqual(g,b)){a.set(e.dataIndex,g)}else{d.getView().getEl(e).focus()}f.context.value=g;f.fireEvent("edit",f,f.context)}},cancelEdit:function(){var c=this,b=c.getActiveEditor(),a=c.grid.getView().getEl(c.getActiveColumn());c.setActiveEditor(null);c.setActiveColumn(null);c.setActiveRecord(null);if(b){b.cancelEdit();a.focus();c.callParent(arguments)}},startEditByPosition:function(a){var b=this.grid.getSelectionModel();a.column=this.view.getHeaderCt().getVisibleHeaderClosestToIndex(a.column).getIndex();if(b.selectByPosition){b.selectByPosition(a)}return this.startEdit(a.row,a.column)}});