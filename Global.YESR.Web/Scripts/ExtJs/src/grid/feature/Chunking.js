Ext.define("Ext.grid.feature.Chunking",{extend:"Ext.grid.feature.Feature",alias:"feature.chunking",chunkSize:20,rowHeight:Ext.isIE?27:26,visibleChunk:0,hasFeatureEvent:false,attachEvents:function(){this.view.el.on("scroll",this.onBodyScroll,this,{buffer:300})},onBodyScroll:function(f,c){var b=this.view,d=c.scrollTop,a=Math.floor(d/this.rowHeight/this.chunkSize);if(a!==this.visibleChunk){this.visibleChunk=a;b.refresh();b.el.dom.scrollTop=d;b.el.dom.scrollTop=d}},collectData:function(d,l,k,j,h){var c={fullWidth:h.fullWidth,chunks:[]},e=h.rows.length,b=0,f=0,a=this.visibleChunk,g,n,m;for(;b<e;b+=this.chunkSize,f++){if(b+this.chunkSize>e){m=e-b}else{m=this.chunkSize}if(f>=a-1&&f<=a+1){n=h.rows.slice(b,b+this.chunkSize)}else{n=[]}c.chunks.push({rows:n,fullWidth:j,chunkHeight:m*this.rowHeight})}return c},getTableFragments:function(){return{openTableWrap:function(){return'<tpl for="chunks"><div class="'+Ext.baseCSSPrefix+'grid-chunk" style="height: {chunkHeight}px;">'},closeTableWrap:function(){return"</div></tpl>"}}}});